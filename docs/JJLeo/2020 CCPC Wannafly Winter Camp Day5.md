# 2020 CCPC Wannafly Winter Camp Day5

## A

### 题意

一共有 $n$ 个账号，可能有两个不同账号属于同一个人。一共举办了 $k$ 场比赛，每场比赛有一部分账号参加，如果有一场比赛两个账号同时参与了，那么它们一定是属于两个人的。问这些账号最少是属于多少个人的。($1 \le n \le 10^5$，$1 \le k \le 3$)

### 题解

最  难  签  到  题

只需考虑 $k=3$ 的情况：

- 如果一个账号三场比赛都参加了，那么它必然要额外算一个人。
- 如果一个账号参加了两场比赛，那么任意两个这样的账号一定都对应了不同的人，可以都先算上，再让可以和它们进行“匹配”的账号不算。
- 如果一个账号只参加了一场比赛，那么它可以和参加了另外两场的账号进行“匹配”，最后设只参加每场比赛的人数各有 $x_1,x_2,x_3$，则将它们合并所需的人数即为 $\max(x_1,x_2,x_3)$。
- 没有参加任何比赛的账号不需要管，它们可以属于到任意一个人。

## B

### 题意

给定一颗 $n$ 个节点的树，初始每个点 $u$ 对应一个集合 $S_u=\{u\}$。有 $m$ 次操作，每次选择一条边 $(u_i,v_i)$，令 $S_{u_i}$ 和 $S_{v_i}$ 同时变为 $S_{u_i} \cup S_{v_i}$。问所有操作过后每个点属于多少个点对应的集合。($1 \le n,m \le 5 \times 10^5$)

### 题解

首先考虑如何求解每个集合最终元素个数，$|S_{u_i} \cup S_{v_i}| = |S_{u_i}|+|S_{v_i}|-|S_{u_i} \cap S_{v_i}|$，由于本题是给出的是一颗树，从而一个点 $i \in |S_{u_i} \cap S_{v_i}|$ 必然是之前对 $(u_i,v_i)$ 这条边操作过一次，从而 $|S_{u_i} \cap S_{v_i}|$ 即为上次操作 $(u_i,v_i)$ 后的得到集合的大小，初始均为 $0$。这样每次操作后更新这个值，每次操作只需 $O(1)$ 的复杂度。

下面考虑如何求解每个点属于多少个点对应的集合，我们可以如下构建一个允许重边的图，初始为空：对于第 $i$ 次操作，新建一条权值为 $i$ 的无向边 $(u_i,v_i)$。

那么如果点 $i \in S_j$，意味着存在一条从 $i$ 到 $j$ 的权值递增的路径。那么如果我们将所有操作逆序，则存在一条从 $j$ 到 $i$ 的权值递增的路径，即逆序操作完毕后有 $j \in S_i $，因此逆序操作完毕后 $|S_i|$ 即为正序操作后点 $i$ 点属于多少个点对应的集合的数量。从而我们将所有操作逆序利用上面的方法维护每个集合大小即可。